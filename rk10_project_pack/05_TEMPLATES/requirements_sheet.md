# Template: 要件定義書

## 概要
RK10ロボットの要件定義書テンプレート（Excel形式）

---

## テンプレートファイル
`C:\ProgramData\RK10\Tools\47出退勤確認_要件定義書テンプレート 20260115.xlsx`

---

## シート構成（10シート）

| No | シート名 | 内容 |
|----|----------|------|
| 1 | 1.概要 | プロジェクト概要、目的、背景 |
| 2 | 2.機能要件 | 機能ID・機能名・説明（A4縦1枚：14項目程度） |
| 3 | 3.非機能要件 | 要件ID・カテゴリ・説明（A4縦1枚：9項目程度） |
| 4 | 4.処理条件詳細 | 条件ID・条件名・判定ロジック |
| 5 | 5.データ仕様 | 設定ファイル・マスタファイルの仕様 |
| 6 | 6.外部IF・制約 | 外部システム接続仕様 |
| 7 | 7.設計思想 | アーキテクチャ、Pythonコマンド一覧 |
| 8 | 8.業務フロー | ステップ・処理内容・入出力ファイルパス |
| 9 | 9.PDD詳細手順 | 詳細処理ステップ（セレクタ、コマンド） |
| 10 | 客先確認事項 | 確認が必要な事項リスト |

---

## シート1: 概要

| 項目 | 内容 |
|------|------|
| **プロジェクト名** | [ロボット番号] [ロボット名] |
| **バージョン** | 1.0 |
| **作成日** | YYYY/MM/DD |
| **作成者** | [担当者名] |
| **目的** | [このロボットで達成したいこと] |
| **背景** | [なぜこのロボットが必要なのか] |
| **対象業務** | [自動化対象の業務内容] |
| **対象システム** | [操作対象のシステム名] |
| **実行タイミング** | [5日/15日/25日/末日/毎日 等] |
| **実行者** | [実行担当者/部署] |

---

## シート2: 機能要件

| 機能ID | 機能名 | 説明 | 優先度 |
|--------|--------|------|--------|
| F-001 | ログイン | 対象システムにログインする | 必須 |
| F-002 | データ取得 | 対象月のデータをCSVでダウンロード | 必須 |
| F-003 | データ変換 | CSVをExcel形式に変換 | 必須 |
| F-004 | Excel転記 | 所定のフォーマットに転記 | 必須 |
| F-005 | 保存 | 指定フォルダに保存 | 必須 |
| F-006 | 完了通知 | 処理完了をメールで通知 | 任意 |
| F-007 | エラー通知 | エラー発生時にメールで通知 | 必須 |

**A4縦1枚に収めるため、14項目程度を目安**

---

## シート3: 非機能要件

| 要件ID | カテゴリ | 説明 |
|--------|----------|------|
| NF-001 | 実行時間 | 100件あたり5分以内 |
| NF-002 | リトライ | 失敗時は最大10回リトライ |
| NF-003 | ログ | 処理開始/終了/エラーをログ出力 |
| NF-004 | 認証 | Windows資格情報マネージャーを使用 |
| NF-005 | 環境切替 | env.txtでPROD/LOCAL切替 |
| NF-006 | エラー停止 | 異常検知時は即座に停止 |
| NF-007 | 通知 | 異常発生時はメールで通知 |
| NF-008 | 再実行安全 | 二重登録を防止する設計 |
| NF-009 | 保守性 | ハードコード禁止、設定ファイル化 |

**A4縦1枚に収めるため、9項目程度を目安**

---

## シート4: 処理条件詳細

| 条件ID | 条件名 | 判定ロジック | 処理 |
|--------|--------|--------------|------|
| C-001 | 対象月判定 | 実行日が1〜14日→前月、15日以降→当月 | 対象月を設定 |
| C-002 | ファイル存在 | 出力ファイルが既に存在 | 上書き保存 |
| C-003 | データなし | 対象データが0件 | ログ出力して正常終了 |
| C-004 | 金額不一致 | 合計金額が請求書と不一致 | エラー通知 |

---

## シート5: データ仕様

### 設定ファイル

| ファイル | パス | 形式 |
|----------|------|------|
| 環境設定 | `config\env.txt` | テキスト |
| 本番設定 | `config\RK10_config_PROD.xlsx` | Excel |
| ローカル設定 | `config\RK10_config_LOCAL.xlsx` | Excel |

### 設定ファイル項目（RK10_config_*.xlsx）

| セル | 項目名 | 値（PROD例） | 値（LOCAL例） |
|------|--------|-------------|---------------|
| B2 | ENV | PROD | LOCAL |
| B3 | ROOT_PATH | `\\server\share` | `C:\work` |
| B4 | INPUT_PATH | `\\server\input` | `C:\work\input` |
| B5 | OUTPUT_PATH | `\\server\output` | `C:\work\output` |

### マスタファイル

| ファイル | パス | 用途 |
|----------|------|------|
| 従業員マスタ | `config\employee_master.csv` | 従業員ID・氏名・部門 |
| 科目マスタ | `config\account_master.csv` | 科目コード・科目名 |

---

## シート6: 外部IF・制約

### 外部システム

| システム名 | URL/接続先 | 認証方式 |
|-----------|-----------|---------|
| 楽楽精算 | `https://xxx.rakurakuseisan.jp` | ID/PW |
| 基幹システム | `https://xxx.company.com` | SSO |

### 制約事項

| No | 制約内容 |
|----|----------|
| 1 | 楽楽精算のメンテナンス時間（日曜2:00-6:00）は実行不可 |
| 2 | 月末締め処理中は基幹システムへの書き込み不可 |
| 3 | VPN接続が必要 |

---

## シート7: 設計思想

### アーキテクチャ

```
RK10シナリオ（.rks）
    ├── env.txt読み込み
    ├── 設定ファイル読み込み
    ├── Python呼び出し（main.py）
    │     ├── スクレイピング処理
    │     ├── データ変換処理
    │     └── Excel出力
    ├── 結果確認
    └── 完了通知
```

### Pythonコマンド一覧

| コマンド | 説明 | 引数 |
|---------|------|------|
| `main.py --scrape` | データ取得 | `--month YYYYMM` |
| `main.py --convert` | データ変換 | `--input PATH` |
| `main.py --export` | Excel出力 | `--output PATH` |

---

## シート8: 業務フロー

| Step | 処理内容 | 入力 | 出力 | 備考 |
|------|----------|------|------|------|
| 1 | 環境判定 | `config\env.txt` | ENV変数 | PROD/LOCAL |
| 2 | 設定読込 | `config\RK10_config_{ENV}.xlsx` | 各種パス | |
| 3 | ログイン | 資格情報 | セッション | 資格情報マネージャー |
| 4 | データ取得 | 対象月 | CSV | |
| 5 | ZIP解凍 | ZIPファイル | CSVフォルダ | |
| 6 | データ変換 | CSV | 整形済データ | |
| 7 | Excel転記 | 整形済データ | `output\result.xlsx` | |
| 8 | 保存 | | `\\server\share\result.xlsx` | |
| 9 | 完了通知 | | メール | |

**パスは必ずフルパスで記載**

---

## シート9: PDD詳細手順

| Step | アクション | 対象 | セレクタ/コマンド | 値 |
|------|-----------|------|------------------|-----|
| 1.1 | 開く | ブラウザ | OpenBrowser | `https://xxx.com` |
| 1.2 | 入力 | ユーザーID | `//input[@id='user']` | `{USER_ID}` |
| 1.3 | 入力 | パスワード | `//input[@id='pass']` | `{PASSWORD}` |
| 1.4 | クリック | ログインボタン | `//button[@type='submit']` | |
| 1.5 | 待機 | 画面遷移 | WaitForElement | `//div[@class='main']` |

---

## シート10: 客先確認事項

| No | カテゴリ | 確認事項 | 回答 | 回答日 |
|----|----------|----------|------|--------|
| 1 | 仕様 | 対象月の判定基準は実行日ベースでよいか？ | | |
| 2 | 運用 | エラー時の連絡先メールアドレスは？ | | |
| 3 | 環境 | VPN接続は常時可能か？ | | |
| 4 | データ | 過去データの再処理は必要か？ | | |

---

## 作成時の注意点

1. **テンプレートコピー後、全シートの内容を対象ロボット用に書き換える**
2. **シート2,3はA4縦1枚に収まるよう圧縮**
3. **原本・出力ファイルのパスは必ずフルパスで記述**（LOCAL/PROD両方）
4. **openpyxlでの編集時はシート名ではなくインデックスでアクセス**（エンコーディング問題回避）

---

## 出力先
`C:\ProgramData\RK10\Robots\{ロボット番号}{ロボット名}\docs\{ロボット名}_要件定義書.xlsx`
