# RK10シナリオ開発 プロジェクト指示書

## このプロジェクトについて

KEYENCE RK-10 RPAを使用した業務自動化シナリオの開発・保守プロジェクト。
経理業務（楽楽精算、勘定奉行連携）、勤怠管理（レコル、サイボウズ連携）、その他バックオフィス業務の自動化を担当。

---

## 最重要原則：RPA自動化の品質基準

### 既存業務の置き換え = 100%の品質が必須

**RPA自動化の対象は、今まさに人が100%の品質で実行している業務である。**

| 領域 | 現状 | 求められる品質 |
|------|------|--------------|
| 新規領域（AI取締役など） | 存在しない | 60%でも価値あり |
| **既存業務の自動化** | **人が100%で実施** | **100%必須** |

### 100%の品質 = ミスが起きない + ミス発生時に確実に対応できる

**ミスや例外は必ず起きる**前提で設計する（TPS/トヨタ生産方式）。

| TPS原則 | RPA設計への適用 |
|---------|----------------|
| **ポカヨケ** | 異常データ・想定外状態を自動検知し、処理を止める |
| **アンドン** | 異常発生時に即座に担当者へ通知 |
| **自働化** | 異常時は自動停止、正常時のみ継続 |

---

## 技術スタック

| カテゴリ | 技術 |
|----------|------|
| RPA基盤 | KEYENCE RK-10 (v3.6.x) |
| スクリプト言語 | C# (RK10内蔵), Python 3.11+ |
| ブラウザ自動化 | Playwright (Python) |
| UI自動化 | pywinauto (UIA backend) |
| Excel操作 | openpyxl, Keyence.ExcelActions |
| 認証管理 | Windows資格情報マネージャー |

---

## プロジェクト構造

```
C:\ProgramData\RK10\Robots\
├── 37レコル公休・有休登録\     # サイボウズ→レコル連携
├── 42ドライブレポート抽出作業\  # ドライブレポート月次処理
├── 43 一般経費_...(ETC)明細\    # ETC明細→Excel集計
├── 47出退勤確認\                # レコル出退勤データ処理
├── 55 １５日２５日末日振込\     # 楽楽精算→振込Excel
└── 56 資金繰り表エクセル入力\   # IB→資金繰り表連携

各ロボットフォルダ構造:
├── scenario/          # RKSファイル（.rks = ZIP形式）
├── config/            # 設定ファイル（env.txt, RK10_config_*.xlsx）
├── tools/             # Pythonスクリプト
├── work/              # 作業ディレクトリ
│   ├── input/         # 入力ファイル
│   ├── output/        # 出力ファイル
│   └── log/           # ログファイル
└── docs/              # ドキュメント
```

---

## 環境切り替えパターン

### env.txt + RK10_config_{ENV}.xlsx

```
config/
├── env.txt                    # "PROD" or "LOCAL"
├── RK10_config_PROD.xlsx      # 本番環境設定
└── RK10_config_LOCAL.xlsx     # ローカル環境設定
```

**env.txt内容**:
```
PROD
```

**RK10_config_*.xlsx構造**:
| セル | 項目 | 例 |
|------|------|-----|
| B2 | ENV | PROD/LOCAL |
| B3 | ROOT_PATH | \\\\server\\share |
| B4 | INPUT_DIR | 入力ファイルパス |
| B5 | OUTPUT_DIR | 出力ファイルパス |

---

## 改善（Kaizen）の基本姿勢

- 改善＝「変えること」。議論で決着を狙わず、**小さく変えて、測って、学んで、また変える**
- 変更は必ず「安全に」行う:
  - 例外検知→停止（ポカヨケ/自働化）
  - 即時通知（アンドン）
  - リラン安全（再実行で二重登録しない等）
  - 検証（代表入力/照合/ログ確認）の実施
- 部分最適禁止：改善案は常に**前後工程・処理量・待ち・例外・手戻り**まで含めて評価する

### 改善タスクの標準フォーマット

```
- Current（現状）:
- Problem（困りごと）:
- Target（狙う状態）:
- Change（今回"変える"こと）:
- Verification（測り方/検証コマンド/照合観点）:
- Safety（例外時の停止/通知/リラン安全）:
- Next（うまくいかない場合の次の一手）:
```

---

## Exit Criteria（完了条件）

**変更がある場合：**
- [ ] 変更点（何を/なぜ）を要約した
- [ ] 検証手順（コマンド/操作）を提示した
- [ ] 検証結果（成功/失敗、代表サンプルの結果）を示した
- [ ] 例外系（停止・通知・再実行安全）の観点が落ちていない

---

## パス表記ルール（必須）

ファイルパスをユーザーに伝えるときは、**必ずフルパス**で提示する（相対パス禁止）。
- 要件定義書・手順書・運用指示・引継ぎは必ずフルパス（LOCAL/PROD両方あるなら両方）

---

## データを扱う前に必ず確認（必須チェック）

1. **このデータの正確なソースは何か？**（API、既存マスタ、公式ドキュメントなど）
2. **既に正確なデータが存在しないか？**（既存のマスタ、APIレスポンス）
3. **楽な方法を選ぼうとしていないか？**（楽な方法 ≠ 正しい方法）

---

## 設計思想

### 「人間の判断を代替する」のではなく「人間が判断しやすい状態を作る」

**ロボットの役割:**
1. データを集める（スクレイピング）
2. パターンに基づいて分類・提案する
3. 人間が確認しやすいレポートを出力する
4. 確認済みデータを転記する

**人間の役割:**
1. 科目の最終確認・修正
2. 按分が必要な明細の判断と分割
3. 例外ケースの処理

---

## 参照ドキュメント

| ドキュメント | 用途 |
|-------------|------|
| `01_INDEX.md` | ナレッジベース目次 |
| `02_DESIGN_PATTERNS.md` | 設計パターン集 |
| `03_TROUBLESHOOTING.md` | トラブルシューティング |
| `04_PLAYBOOKS/` | 手順書集 |
| `05_TEMPLATES/` | テンプレート集 |
| `06_SNIPPETS/` | コードスニペット集 |
