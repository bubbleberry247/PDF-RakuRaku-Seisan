# Error Codes

## 1. エラーコード一覧

| error_code | 分類 | 説明 | 原則アクション |
|------------|------|------|----------------|
| AUTH_EXPIRED | 認証 | セッション切れ、ログイン失敗 | 停止→メール→手動再ログイン or 再実行 |
| AUTH_INVALID | 認証 | 認証情報不正 | 停止→メール→認証情報確認 |
| ELEMENT_NOT_FOUND | 画面差分 | 要素が見つからない | 停止→メール→画面確認→設計更新 |
| ELEMENT_NOT_VISIBLE | 画面差分 | 要素が非表示 | 停止→メール→画面状態確認 |
| TIMEOUT | 待機 | タイムアウト発生 | リトライ→ダメなら停止→メール |
| IO_FILE_LOCK | ファイルI/O | ファイルロック中 | 待機/リトライ→停止→メール |
| IO_FILE_NOT_FOUND | ファイルI/O | ファイルが存在しない | 停止→メール→ファイル確認 |
| IO_PERMISSION | ファイルI/O | 権限エラー | 停止→メール→権限確認 |
| DATA_VALIDATION | データ | 入力データ不正 | 停止→メール→データ確認 |
| DATA_EMPTY | データ | データが空 | 停止→メール→データ確認 |
| NETWORK_ERROR | ネットワーク | 接続エラー | リトライ→停止→メール |
| NETWORK_TIMEOUT | ネットワーク | 接続タイムアウト | リトライ→停止→メール |
| SYSTEM_ERROR | システム | 予期しないエラー | 停止→メール→ログ確認 |

---

## 2. エラーコード詳細

### 2.1 AUTH_EXPIRED（認証エラー - セッション切れ）

**発生条件**:
- ログインセッションのタイムアウト
- 他端末でのログインによるセッション無効化

**検出方法**:
- ログインページへのリダイレクト検出
- 「セッションが切れました」メッセージ検出

**対応手順**:
1. 処理を即時停止
2. エラー通知メール送信
3. 手動で再ログイン
4. STEP_IDを指定して再実行

**リトライ**: No（手動介入必要）
**再実行**: Yes（手動介入後）

---

### 2.2 ELEMENT_NOT_FOUND（要素未検出）

**発生条件**:
- 画面レイアウト変更
- セレクタの陳腐化
- 動的要素の読み込み遅延

**検出方法**:
- セレクタによる要素取得失敗
- 待機タイムアウト

**対応手順**:
1. 処理を即時停止
2. エラー通知メール送信
3. スクリーンショット確認
4. セレクタ修正後、再デプロイ
5. 再実行

**リトライ**: No（構造的問題）
**再実行**: No（修正が必要）

---

### 2.3 TIMEOUT（タイムアウト）

**発生条件**:
- ページ読み込み遅延
- ネットワーク遅延
- サーバー応答遅延

**検出方法**:
- 待機時間超過

**対応手順**:
1. 自動リトライ（最大3回）
2. リトライ失敗時、停止
3. エラー通知メール送信
4. 原因調査後、再実行

**リトライ**: Yes（3回）
**再実行**: Yes

---

### 2.4 IO_FILE_LOCK（ファイルロック）

**発生条件**:
- 他プロセスがファイルを使用中
- Excelファイルが開かれている

**検出方法**:
- ファイルオープン失敗
- 権限エラー（一時的）

**対応手順**:
1. 待機（10秒）
2. リトライ（最大3回）
3. リトライ失敗時、停止
4. エラー通知メール送信
5. ファイル状態確認後、再実行

**リトライ**: Yes（3回、10秒間隔）
**再実行**: Yes

---

## 3. エラーコード追加ガイドライン

新しいエラーパターンを検出した場合:

1. 既存のerror_codeに該当するか確認
2. 該当しない場合、新規error_codeを追加
3. 以下の情報を記載:
   - 発生条件
   - 検出方法
   - 対応手順
   - リトライ可否
   - 再実行可否

### 命名規則

```
{CATEGORY}_{DETAIL}
```

| カテゴリ | 説明 |
|----------|------|
| AUTH | 認証関連 |
| ELEMENT | 画面要素関連 |
| TIMEOUT | タイムアウト関連 |
| IO | ファイルI/O関連 |
| DATA | データ関連 |
| NETWORK | ネットワーク関連 |
| SYSTEM | システム関連 |
